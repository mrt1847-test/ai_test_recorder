<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="vendor/codemirror/codemirror.css">
<link rel="stylesheet" href="vendor/codemirror/neo.css">
<style>
  body {
    width: 100%;
    height: 100vh;
    margin: 0;
    padding: 8px;
    overflow-x: hidden;
    overflow-y: auto;
    box-sizing: border-box;
  }
  html {
    height: 100%;
    overflow: visible;
  }
  #main {
    min-height: 100%;
    overflow-y: visible;
  }
</style>
</head>
<body>
  <!-- 간단한 헤더 -->
  <div class="recorder-header">
    <div class="recorder-header-main">
      <div class="recorder-controls">
        <button id="start-record" class="recorder-btn recorder-btn-primary">
          <span class="recorder-btn-icon">●</span>
          <span>Record</span>
        </button>
        <button id="stop-record" class="recorder-btn" disabled>
          <span class="recorder-btn-icon">■</span>
          <span>Stop</span>
        </button>
        <button id="replay-btn" class="recorder-btn">
          <span class="recorder-btn-icon">▶</span>
          <span>Replay</span>
        </button>
      </div>
      <div class="recorder-header-actions">
        <button id="settings-toggle-btn" class="recorder-btn-icon-only" title="설정">
          <span>⚙</span>
        </button>
      </div>
    </div>
    <div id="settings-panel" class="settings-panel hidden">
      <div class="settings-content">
        <div class="settings-section">
          <h5>기본 설정</h5>
          <div class="settings-row">
            <label class="settings-field" for="framework-select">
              <span class="settings-label">프레임워크</span>
              <select id="framework-select">
                <option value="playwright">Playwright</option>
                <option value="selenium">Selenium</option>
                <option value="cypress">Cypress</option>
              </select>
            </label>
            <label class="settings-field" for="language-select">
              <span class="settings-label">언어</span>
              <select id="language-select">
                <option value="python">Python</option>
                <option value="python-class">Python (Class)</option>
                <option value="javascript">JavaScript</option>
                <option value="typescript">TypeScript</option>
              </select>
            </label>
          </div>
        </div>
        <div class="settings-section">
          <h5>TestArchitect 연동</h5>
          <div class="settings-row">
            <label class="settings-field" for="tc-id-input">
              <span class="settings-label">TC ID *</span>
              <input id="tc-id-input" type="number" placeholder="123" min="1" required/>
            </label>
            <label class="settings-field" for="project-id-input">
              <span class="settings-label">Project ID</span>
              <input id="project-id-input" type="number" placeholder="1" min="1" value="1"/>
            </label>
            <div class="settings-field">
              <button id="send-recording-btn" class="recorder-btn">전송</button>
            </div>
          </div>
        </div>
        <div class="settings-section">
          <h5>AI 설정</h5>
          <div class="settings-row">
            <label class="settings-field" for="ai-endpoint">
              <span class="settings-label">API Endpoint</span>
              <input id="ai-endpoint" placeholder="https://api.example.com/selectors" autocomplete="off" />
            </label>
            <label class="settings-field" for="ai-api-key">
              <span class="settings-label">API 키</span>
              <input id="ai-api-key" type="password" placeholder="API 키를 입력하세요" autocomplete="off" />
            </label>
            <label class="settings-field" for="ai-model">
              <span class="settings-label">모델</span>
              <input id="ai-model" placeholder="예: gpt-4.1-mini" autocomplete="off" />
            </label>
            <div class="settings-field">
              <button id="ai-settings-save" class="recorder-btn">저장</button>
              <span id="ai-settings-status" class="ai-settings-status"></span>
            </div>
          </div>
        </div>
        <div class="settings-section">
          <h5>기타</h5>
          <div class="settings-row">
            <button id="element-select-btn" class="recorder-btn">요소 선택</button>
            <div class="action-menu-wrapper">
              <button id="action-btn" class="recorder-btn">Action 추가 ▼</button>
              <div id="action-menu" class="action-menu hidden">
                <div class="action-menu-category">
                  <div class="action-menu-header">상호작용</div>
                  <button data-action-type="interaction" data-action="click">클릭</button>
                  <button data-action-type="interaction" data-action="doubleClick">더블 클릭</button>
                  <button data-action-type="interaction" data-action="rightClick">우클릭</button>
                  <button data-action-type="interaction" data-action="hover">호버</button>
                  <button data-action-type="interaction" data-action="type">입력</button>
                  <button data-action-type="interaction" data-action="clear">입력 필드 비우기</button>
                  <button data-action-type="interaction" data-action="select">드롭다운 선택</button>
                </div>
                <div class="action-menu-category">
                  <div class="action-menu-header">검증</div>
                  <button data-action-type="verify" data-action="verifyText">텍스트 검증</button>
                  <button data-action-type="verify" data-action="verifyElementPresent">요소 존재 검증</button>
                  <button data-action-type="verify" data-action="verifyElementNotPresent">요소 부재 검증</button>
                  <button data-action-type="verify" data-action="verifyTitle">타이틀 검증</button>
                  <button data-action-type="verify" data-action="verifyUrl">URL 검증</button>
                </div>
                <div class="action-menu-category">
                  <div class="action-menu-header">대기</div>
                  <button data-action-type="wait" data-action="waitForElement">요소 대기</button>
                  <button data-action-type="wait" data-action="wait">시간 대기</button>
                </div>
              </div>
            </div>
            <button id="overlay-toggle-btn" class="recorder-btn" aria-pressed="false">오버레이 표시</button>
            <button id="reset-btn" class="recorder-btn">초기화</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="main">
    <!-- 단계 리스트 (메인) -->
    <div id="steps-panel" class="steps-panel">
      <div class="steps-header">
        <h4>Steps</h4>
        <div class="steps-header-actions">
          <button id="delete-event-btn" class="step-action-btn" disabled title="선택된 단계 삭제">🗑</button>
        </div>
      </div>
      <div id="timeline" class="steps-list"></div>
      <div id="steps-empty" class="steps-empty hidden">
        <p>녹화를 시작하면 단계가 여기에 표시됩니다.</p>
      </div>
      <!-- 독립적인 Assertion 추가 섹션 -->
      <div id="global-assertion-section" class="global-assertion-section">
        <button id="global-add-assertion-btn" class="global-add-assertion-btn">
          <span>+</span>
          <span>Add assertion</span>
        </button>
        <div id="global-assertion-menu" class="global-assertion-menu hidden">
          <div class="assertion-menu-header">Assertion 타입 선택</div>
          <div class="assertion-menu-buttons">
            <button class="assertion-menu-btn" data-assertion="verifyText">텍스트 검증</button>
            <button class="assertion-menu-btn" data-assertion="verifyElementPresent">요소 존재 검증</button>
            <button class="assertion-menu-btn" data-assertion="verifyElementNotPresent">요소 부재 검증</button>
            <button class="assertion-menu-btn" data-assertion="verifyTitle">타이틀 검증</button>
            <button class="assertion-menu-btn" data-assertion="verifyUrl">URL 검증</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 선택된 단계의 상세 정보 (접을 수 있음) -->
    <div id="step-details-panel" class="step-details-panel hidden">
      <div class="step-details-header">
        <h4>Step Details</h4>
        <button id="step-details-close" class="step-details-close">✕</button>
      </div>
      <div id="step-details-content">
        <div id="iframe-banner" class="hidden">⚠️ 이 요소는 iframe 내부에 있습니다. 자동 전환 필요</div>
        <div id="selector-panel"><h4>추천 셀렉터</h4><div id="selector-list"></div></div>
        <div id="element-panel" class="hidden">
          <div class="element-header">
            <h4>요소 선택 흐름</h4>
            <button id="element-cancel-btn">취소</button>
          </div>
          <div id="element-status"></div>
          <div id="element-path" class="element-section hidden">
            <div class="element-title">선택 경로</div>
            <div id="element-path-items"></div>
          </div>
          <div id="element-candidates" class="element-section"></div>
          <div id="element-actions" class="element-section hidden">
            <div class="element-title">동작 선택</div>
            <div class="element-action-buttons">
              <button data-action="click">클릭 이벤트 추가</button>
              <button data-action="text">텍스트 가져오기</button>
              <button data-action="value">값(value) 가져오기</button>
              <button data-action="attribute">속성 가져오기</button>
              <button data-action="child">하위 노드 선택</button>
              <button data-action="parent">상위 노드로 이동</button>
              <button data-action="commit">선택 완료</button>
              <button data-action="finish">선택 취소</button>
            </div>
          </div>
          <div id="interaction-actions" class="element-section hidden">
            <div class="element-title">상호작용 액션</div>
            <div class="element-action-buttons">
              <button data-interaction="click">클릭</button>
              <button data-interaction="doubleClick">더블 클릭</button>
              <button data-interaction="rightClick">우클릭</button>
              <button data-interaction="hover">호버</button>
              <button data-interaction="type">입력</button>
              <button data-interaction="clear">입력 필드 비우기</button>
              <button data-interaction="select">드롭다운 선택</button>
            </div>
          </div>
          <div id="verify-actions" class="element-section hidden">
            <div class="element-title">검증 액션</div>
            <div class="element-action-buttons">
              <button data-verify="verifyText">텍스트 검증</button>
              <button data-verify="verifyElementPresent">요소 존재 검증</button>
              <button data-verify="verifyElementNotPresent">요소 부재 검증</button>
              <button data-verify="verifyTitle">타이틀 검증</button>
              <button data-verify="verifyUrl">URL 검증</button>
            </div>
          </div>
          <div id="wait-actions" class="element-section hidden">
            <div class="element-title">대기 액션</div>
            <div class="element-action-buttons">
              <button data-wait="waitForElement">요소 대기</button>
              <button data-wait="wait">시간 대기</button>
            </div>
            <div id="wait-input-panel" class="element-section hidden">
              <div class="element-title">대기 시간 (밀리초)</div>
              <div class="element-attr-row">
                <input id="wait-time-input" type="number" placeholder="2000" min="0" />
                <button id="wait-time-apply">적용</button>
              </div>
            </div>
          </div>
          <div id="element-attribute-panel" class="element-section hidden">
            <div class="element-title">속성 추출</div>
            <div class="element-attr-row">
              <input id="element-attr-name" placeholder="속성명 (예: href)" />
              <button id="element-attr-apply">적용</button>
            </div>
          </div>
          <div id="element-code-preview" class="element-section hidden">
            <div class="element-title">현재 코드 미리보기</div>
            <pre><code id="element-code"></code></pre>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 코드 미리보기 (접을 수 있음) -->
    <div id="code-area" class="code-area">
      <div class="code-area-header">
        <h4>Code Preview</h4>
        <div class="code-area-header-actions">
          <div class="code-review-controls">
            <span id="ai-review-btn-wrapper" class="ai-review-btn-wrapper">
              <button id="ai-review-btn" class="recorder-btn">AI 검토</button>
            </span>
            <span id="ai-review-help" class="ai-review-help" role="button" aria-label="AI 검토 기능 안내" tabindex="0" aria-haspopup="true">!</span>
            <span id="ai-review-status" class="code-review-status"></span>
          </div>
          <button id="code-area-toggle" class="code-area-toggle" title="코드 미리보기 접기/펼치기">▼</button>
        </div>
      </div>
      <div id="code-area-content" class="code-area-content">
        <div id="code-editor">
          <textarea id="code-output" spellcheck="false" wrap="off"></textarea>
        </div>
        <div id="code-review-summary" class="code-review-summary hidden"></div>
        <div id="code-review-diff" class="code-review-diff hidden"></div>
      </div>
    </div>
    
    <!-- Replay Log (접을 수 있음) -->
    <div id="replay-log" class="replay-log">
      <div class="replay-log-header">
        <h4>Replay Log</h4>
        <button id="replay-log-toggle" class="replay-log-toggle">▼</button>
      </div>
      <div id="replay-log-content" class="replay-log-content">
        <div id="log-entries"></div>
      </div>
    </div>
  </div>

<script src="vendor/codemirror/codemirror.js"></script>
<script src="vendor/codemirror/javascript.js"></script>
<script src="vendor/codemirror/python.js"></script>
<script src="side_panel.js"></script>
</body>
</html>


